## 扩展方法

- 现在用上了最新的框架,而最新框架中没有了extend.php文件,所以如果想使用扩展方法,那就得自己去新建一个文件,这个文件可能还要用到框架自带方法,所以就需要require系统中的`base.php`.

- 最后写好了之后到系统基类`adIndexClass.php`中引入即可

  ```php
  require_once ("control/base.php");
  trait extendClass{
  //..所有函数
  }
  ```

  ```php
  require_once ("../extendClass.php");
  class adIndexClass{
      use extendClass;
      /*属性*/
     }
  ```

- 就是要注意,所有这个拓展类中的函数使用都必须加$this.

---

- 在接口中如果要使用那些系统中的函数以及我们自己编写的`extendClass`中的函数,需要特别处理

- 因为首先接口文件不是Class文件,所以不能extend基类.

- 该怎么做呢?一共有两种方法

  1. 第一种是在接口最开头写一个简单类,在类中`use extendClass`,然后在下方实例化这个类,就可以用这个类引用拓展的方法了.

     ```php
     require ("../../extendClass.php");
     class extend{
         use extendClass;
     }
     
     $ex = new extend();
     $ex->sqlQuery();
     ```

     当然,那些基类中的方法只需要引入base.php文件即可.

     ```php
     require ("../../control/base.php");
     ```

     

  2. 第二种则是把接口写成类,然后把原先接口中的所有代码放到类中的一个函数中,在结尾echo这个类的实例化.当然,是在类外面echo;

     ```php
     require ("../../extendClass.php");
     class 接口Class{
     	use extendClass;
         
         function 接口(){
             //原先接口中的代码放在这里
         }
     }
     $接口 = new 接口Class();
     echo $接口->接口();
     ```

---

## 跳转

- 使用连接调用方法的时候,最新的框架要这样

  ```php
  $postUrl = root . "control/adIndex.php?cla=".$this->get['cla']."&fun=kehuExport";  //导出的url
  //所有的跳转都要跳到基类才可以,然后cla都是用这个this的,这就自动拿到类名,之后想调用哪个函数就fun=函数名,就会自动调用当前类的那个函数
  ```

## 分支

- 现在最新框架详情页的分支可以直接用其他类中的页面,这样自然也就解决了分支页面中搜索框不好写的问题.

- 首先是在主要类的detail中配置menu,用数组就可以引入其他类

  ```php
  "menu" => array(
      "edit" => "基本信息",
      "account" => array("name" => "商品规格","cla" => "goodsSize","fun" => "goodsSizeAction"),
  ),
  ```

- 然后创建对应的类名的类,进入之后这里填的方法名fun就是搜索栏的函数,表格顶部按钮需要自己写一个方法,方法最后return到列表函数中.

  ```php
  //**行政人事-员工管理-页卡-会计账户**//
  public function goodsSizeAction(){
      $html =
          text(array("name" => "sName","title" => "规格名称")).
          hidden(array("name" => "id","value" => $this->get['id']));
      $json['html'] = $this->search($html);
      return json_encode($json,320);
  }
  /*行政人事-员工管理-员工会计账户-列表*/
  public function goodsSizeActionSearch(){
      //查询对象
      $data['goodsId'] = $this->post['id'];
      $data['button'] .= $this->checkAll("listForm","check");
      //控件
      $sizeArr = query("size"," gId = '".$this->post['id']."' ");//查到对应商品的所以规格
      if(power("goodsList","edit")){
          $data['button'] .= "<span class='spanButton' title='新建规格' onclick=\"layer('goodsSize','goodsSizeEdit',{goodsId:'".$data['goodsId']."'})\">新建规格</span>";
      }
      if(power("goodsList","del")){
          $data['button'] .= "<span onclick=\"pasWarn('listForm','delSize')\" class='spanButton'>删除所选</span>\n";
      }
      //返回
      return $this->accountList($data);
  }
  /*员工会计账户-列表页函数*/
  public function accountList($data){
      //like查询数组
      $like = array(
          "sName" => $this->post['sName'],//规格名称
      );
      //生成查询语句
      $where = search(array("like" => $like));
      //获取查询结果
      $sql = " select * from size where gId='{$data['goodsId']}' ".$where." order by time desc ";
      $page = $this->page(array("cla" => $this->get['cla'],"fun" => $this->get['fun'],"sql" => $sql,"pageGet" => $this->get['page']));
      //获取表头
      $tr[] = array("","规格名称","单位","零售价","成本","库存数量","已销售数量","剩余库存数量","默认规格（是/否）","起购值","更新时间","操作");
      //获取记录
      foreach($page['sql'] as $array){
          $mx = "<span class='spanButton' title='规格详情' onclick=\"layer('goodsSize','goodsSizeEdit',{id:'".$array['id']."',goodsId:'".$data['goodsId']."'})\">详情</span>";
          $checkbox  = "<input name='check[]' type='checkbox' value='".$array['id']."'/>";
          $tr[] = array($checkbox,$array['sName'],$array['unit'],$array['price'],$array['cost'],$array['inventory'],$array['selled'],$array['inventory']-$array['selled'],$array['defaults'],$array['buyOn'],$array['updateTime'],$mx);
      }
      //返回
      $json['html'] = $page['hint'].$data['button']."<form name='listForm'>".space.$this->tableMany(array("tr" => $tr))."</form>".$page['button'].clear;
      return json_encode($json,320);
  }
  ```

---

- **点击提交回显到详情的具体分支页面**

- 现在如果想自己写详情页的提交按钮并且点击之后跳转到对应的详情分支

- 首先需要在分支方法最后返回html外层添加form标签,而自己写的按钮应该在form之内

  ```php
  $url = root."control/adIndex.php?cla=onlineOrder&fun=checkReportEdit&id=".$_GET['id'];
  $json['html'] = "<form name='checkReportForm'>".$this->tableEdit($trData)."
          <div class='formButton' onclick=\"subForm('checkReportForm','".$url."')\">
              更新
          </div>
          </form>";
  return json_encode($json,320);
  ```

- 然后在类中跳转的数据处理方法中写的链接应该是这样的

  ```php
  $json['href'] = root."control/adIndex.php?cla=onlineOrder&fun=detail&id=".$_GET['id']."&menu=checkReport";//这里的fun应该写detail
  ```

---

- 

## 封装方法

### 条件判断

- 现在最新框架详情页的分支可以直接用其他类中的页面,这样自然也就解决了分支页面中搜索框不好写的问题.

- 首先是在主要类的detail中配置menu,用数组就可以引入其他类

  ```php
   "menu" => array(
                      "edit" => "基本信息",
                      "account" => array("name" => "商品规格","cla" => "goodsSize","fun" => "goodsSizeAction"),
                  ),
  ```

- 然后创建对应的类名的类,进入之后这里填的方法名fun就是搜索栏的函数,表格顶部按钮需要自己写一个方法,方法最后return到列表函数中.

  ```php
  //**行政人事-员工管理-页卡-会计账户**//
      public function goodsSizeAction(){
          $html =
          text(array("name" => "sName","title" => "规格名称")).
          hidden(array("name" => "id","value" => $this->get['id']));
          $json['html'] = $this->search($html);
          return json_encode($json,320);
      }
      /*行政人事-员工管理-员工会计账户-列表*/
      public function goodsSizeActionSearch(){
          //查询对象
          $data['goodsId'] = $this->post['id'];
          $data['button'] .= $this->checkAll("listForm","check");
          //控件
          $sizeArr = query("size"," gId = '".$this->post['id']."' ");//查到对应商品的所以规格
          if(power("goodsList","edit")){
              $data['button'] .= "<span class='spanButton' title='新建规格' onclick=\"layer('goodsSize','goodsSizeEdit',{goodsId:'".$data['goodsId']."'})\">新建规格</span>";
          }
          if(power("goodsList","del")){
              $data['button'] .= "<span onclick=\"pasWarn('listForm','delSize')\" class='spanButton'>删除所选</span>\n";
          }
          //返回
          return $this->accountList($data);
      }
      /*员工会计账户-列表页函数*/
      public function accountList($data){
          //like查询数组
          $like = array(
              "sName" => $this->post['sName'],//规格名称
          );
          //生成查询语句
          $where = search(array("like" => $like));
          //获取查询结果
          $sql = " select * from size where gId='{$data['goodsId']}' ".$where." order by time desc ";
          $page = $this->page(array("cla" => $this->get['cla'],"fun" => $this->get['fun'],"sql" => $sql,"pageGet" => $this->get['page']));
          //获取表头
          $tr[] = array("","规格名称","单位","零售价","成本","库存数量","已销售数量","剩余库存数量","默认规格（是/否）","起购值","更新时间","操作");
          //获取记录
          foreach($page['sql'] as $array){
              $mx = "<span class='spanButton' title='规格详情' onclick=\"layer('goodsSize','goodsSizeEdit',{id:'".$array['id']."',goodsId:'".$data['goodsId']."'})\">详情</span>";
              $checkbox  = "<input name='check[]' type='checkbox' value='".$array['id']."'/>";
              $tr[] = array($checkbox,$array['sName'],$array['unit'],$array['price'],$array['cost'],$array['inventory'],$array['selled'],$array['inventory']-$array['selled'],$array['defaults'],$array['buyOn'],$array['updateTime'],$mx);
          }
          //返回
          $json['html'] = $page['hint'].$data['button']."<form name='listForm'>".space.$this->tableMany(array("tr" => $tr))."</form>".$page['button'].clear;
          return json_encode($json,320);
      }
  ```

---

- 有时候会遇到需要判断当前多选删除的数据是否有其他关联数据,如果有则不能删除,封装如下方法可以使用.

  ```php
  /*************判断当前要删除的东西有没有其他的关联数据****************/
  
  /**
       * @param $data
       *          $data['id']:传过来的id数组,因为是多选删除
       *          $data['table']:需要去搜索的表名,也就是可能和要删除的数据有关联的那张表
       *          $data['idName']:需要去搜索的表中的你要删除的数据的ID字段名
       * @return bool 为false则表示没有关联数据,可以删除,否则就不能删除
       */
  public function haveOtherData($data){
      $num = 0;
      foreach ($data['id'] as $id){
          $selectResult = $this->sqlQueryAll("select * from ".$data['table']." where ".$data['idName']." = '$id'");
          if(count($selectResult)==0){
              $num++;
          }
      }
      return $result = count($data['id'])==$num?false:true;
  }
  ```

## 模块显示

- 如果想直接点开左侧菜单就打开详情页这种页面,那就不需要在class里写home和homesearch

- 直接写detail函数,然后关键的是需要去configer里配置.

  ```php
  "店铺管理" => array(
      "shop" => array(
          "name" => "店铺管理",
          "see" => "查询自己",
          "seeAll" => "查询所有",
          "edit" => "编辑",
          "cla" => "shop",
          "fun" => "detail",
      ),
  ),
  //这里需要添加两个数组元素,一个是cla,一个是fun,cla是类名,fun是进入这个页面时调用的函数名
  //所以直接把fun定义为detail,然后去类中写好detail方法就可以在点击左侧菜单的时候直接跳转进detail页面,注意函数中跳转链接也都要写成跳转到detail
  $root = root."control/adIndex.php?cla=shop&fun=detail";
  ```


## 图片上传

- 新框架图片上传分两种情况

  - 图片URL存在某个表的其中一个字段

    ```php
    $listPic[] = ["title" => "列表图像",//上传框题目
                  "url" => $listPicData['url'],//图片url
                  "name" => "commodityList",//类名
                  "fun" => "listPic",//函数名
                  "id" => $commodity['id'],];//存储url的数据的id
    //需要把这个数组放进photo方法
    <span class='listPic'>
        ".$this->photo($listPic)."
        </span>
    
    ```

    ```php
    /*上传橱窗图片*/
    //这个就是上面数组中指向的类中指向的函数
    public function listPic(){
        //赋值
        $id = $this->post['id'];
        $commodity = query("commodity","id = '$id'");
        $listPic = query("listPic"," commodityId = '$id' ");
        //判断
        if(!power("commodityList","edit")){
            $warn = "您没有编辑商品列表图片的权限";
        }else{
            if(empty($listPic['id'])){
                $para = array(
                    "id" => suiji(),
                    "commodityId" => $commodity['id'],
                    "time" => date("Y-m-d H:i:s"),
                    "updateTime" => date("Y-m-d H:i:s"),
                );
                $insert = insert(array("table" => "listPic","field" => $para));
                if($insert=='新增成功'){
                    if($_FILES["file"]['name']){
                        $name = "file";
                        $dir = $this->ThemeUpload($name);
                    }
                    $update = update(array("table" => "listPic",
                                           "field" => ['url' => $dir,
                                                       "updateTime" => date("Y-m-d H:i:s")],
                                           "where" => "id = '$para[id]'"));
                    if($update == "更新成功"){
                        $text = $this->control['adName']."新增了商品-".$commodity['name']."的列表图片";
                        logText(array("type" => "commodityList","text" => $text));
                    }
                }
            }else{
                $para = array(
                    "fileName" => "file",//上传图片的表单文件域名称
                    "sqlSearch" => " select * from listPic where id = '{$listPic['id']}' ",//查询图片的数据库代码
                    "make" => "缩放图像",//处理方式：裁剪图像、缩放图像、空
                    "type" => "更新图像",//插入类型：更新图像、新增图像
                    "field" => "url",//存放图片根目录的数据库字段名
                    "url" => "file/".suiji().".jpg",//新图片保存的网站根目录位置
                    "maxNum" => "",//新增图像时限定的图像总数
                    "newWidth" => 1000,//新图像的宽度
                    "newHeight" => "",//新图像的高度
                    "maxHeight" => 4000,//缩放后图片的最大高度
                );
                $para['sqlIn'] = array("table" => "listPic","field" => array($para['field'] => $para['url'],"updateTime" => date("Y-m-d H:i:s")),"where" => " id = '{$listPic['id']}' ");
                $warn = imgUpdate($para);
                //添加日志
                if($warn == "图像处理成功"){
                    @unlink(serverRoot.$listPic['url']);
                    $text = $this->control['adName']."更新了商品-".$commodity['name']."的列表图片";
                    logText(array("type" => "commodityList","text" => $text));
                }
            }
        }
        $root = root."control/adIndex.php?cla=commodityList&fun=detail&id=".$commodity['id'];
        $_SESSION['warn'] = $warn;
        header("location:".$root);
        exit(0);
    
    }
    ```

    

  - 图片URL单独建表存

    ```php
    $windowPic = $this->sqlQueryAll("select * from windowPic where commodityId = '{$commodity['id']}' order by sequence");
    
    for ($x=0;$x<5;$x++){
        $num = $x+1;
        $sequencePhoto[] = ["title" => "橱窗图像".$num,
                            "url" => $windowPic[$x]['url'],
                            "name" => "commodityList",
                            "formName" => "windowPic".$x,//这里是有顺序的单独图片上传,所以每个上传图片都有一个单独的表单名,在photo中也需要改造一下才可以
                            "fun" => "windowPic",
                            "num" => $x,
                            "id" => $commodity['id'],
                           ];
    }
    <span class='windowPic'>
        ".$this->numPhoto($sequencePhoto)."
        </span>
    ```

    ```php
    public function numPhoto($data){
        $li = "";
        foreach($data as $num => $array){
            //编辑表单
            if(empty($array['fun']) or !power("admin","edit")){
                $click = $form = "";
            }else{
                $click = "<img src='".root."img/images/clickEdit.png' onclick='document.".$array['formName']."Form.file.click();' class='clickIco'>";
                //比如这里就需要改成点击触发formName,因为表单不止一个,不能触发同一个和fun同名的form
                $form = "
    				<form name='".$array['formName']."Form' action='".root."control/adIndex.php?cla=".$array['name']."&fun=".$array['fun']."&num=".$array['num']."' method='post' enctype='multipart/form-data' class='hide'>
    					<input name='file' type='file' num='".$array['num']."' onchange='document.".$array['formName']."Form.submit();'>
    					<input name='id' type='hidden' value='".$array['id']."'>
    				</form>
    				";
            }
            //点击显示大图功能
            if(empty($array['url'])){
                $img = "<img class='smallImg imgHover' src='".root."img/images/emptyImg.jpg'>";
            }else{
                if(strstr($array['url'],"http") !== false){
                    $r = "";
                }else{
                    $r = root;
                }
                $img = "<a target='_blank' href='".$r.$array['url']."' title='点击查看大图'><img class='smallImg imgHover' src='".$r.$array['url']."'></a>";
            }
            //打印本图像框
            $li .= "
    			<li>
    				".$click."
    				<p>".$array['title']."</p>
    				<div>".$img."</div>
    				".$form."
    			</li>
    			";
        }
        $html = "
    		<div class='imgSingle'>
    			<ul>".$li."</ul>
    			<div class='clear'></div>
    		</div>
    		";
        return $html;
    }
    ```

### 上传多张图

- **一次上传多张图片**

- 这首先就涉及到HTML5的内容,在input标签上添加multiple属性就可以支持多选上传

  ```html
  真正的上传按钮,隐藏起来,点击你写的上传图片再触发
  <input id='uploads' name='uploads[]' onchange='preview(this)' multiple style='display: none' type='file'  accept='image/jpeg,image/jpg,image/png' />
  <script>
      $(function() {
          $(\"#uploadButton\").click(function(){
             //如果点击上传图标触发真正的上传按钮
             $('#uploads').trigger('click');
            })
      })
  </script>
  这个是预览标签,上传的图片都塞进这个标签内部
  <div id='preview' style='display: inline-block;'>
  
  </div>
  //上传图标
  <img  style='float: right' id='uploadButton' src='".img('uploadIcon')."'/>
  ```

- 平时用的提交表单的js方法只能提交数据,不能提交文件,需要改造方法,把data改为formData,

  ```js
  /********异步提交函数**************************/
  //图片上传版本js
  function upForm(form,url){
      // alert(form);
      //防止高频点击
      var date = new Date();
      var time = date.getTime();//毫秒时间戳
      if(typeof minTime == "undefined"){
          var finger = 2;
          minTime = time+2000;//下次点击的最小时间
          console.log("定义minTime");
      }else{
          if(minTime && time < minTime){
              var finger = 1;
              warn("操作过于频繁");
              console.log("time:"+time+"，mintime:"+minTime+"，差额："+(time-minTime));
          }else{
              var finger = 2;
              console.log("time:"+time+"，mintime:"+minTime+"，多出："+(time-minTime));
              minTime = time+2000;//下次点击的最小时间
          }
      }
      if(finger == 2){
          $(function(){
              var formData = new FormData($("[name='"+form+"']")[0]);
              console.log(formData.get('file'));
              $.ajax({
                  url: url,
                  type: 'POST',
                  cache: false,
                  data: formData,
                  // 告诉jQuery不要去处理发送的数据
                  processData: false,
                  // 告诉jQuery不要去设置Content-Type请求头
                  contentType: false,
                  beforeSend: function () {
                      console.log("正在进行，请稍候");
                  },
                  success: function (res) {
                      var data = JSON.parse(res);
                      if (data.warn == 2) {
                          if (data.href) {//如果异步返回的json参数中定义了重定向url，则跳转到本url
                              window.location.href = data.href;
                          } else {
                              window.location.reload();
                          }
                      } else {
                          warn(data.warn);
                      }
                  },
                  error: function (responseStr) {
                      console.log("error");
                  }
              });
  
          })
      }
  }
  ```

- 然后去改造对应的生成表单的地方,比如我这里是layer,那就去adIndex文件里改造一下layerEdit方法,生成一个触发upform方法的也就是新提交表单方法的表单.然后在生成layer的时候使用layerEdit方法的时候,参数中添加我们这里判断的参数`$data['upload']`

  ```php
  if(!empty($data['upload'])){
      //这里就是上传图片的新增详情页面自定义js方法的提交按钮
      $button = "<input onclick=\"upForm('".$subForm."','".$url."')\" type='button' class='button' value='确认提交'>";
  }else{
      $button = "<input onclick=\"subForm('".$subForm."','".$url."')\" type='button' class='button' value='确认提交'>";
  }
  ```

- js方面还需要有一个预览方法

  ```js
  //图片上传弹出框预览js
  function preview(a) {
      console.log('files的length');
      console.log(a.files.length);
      //其实这个判断限制不住真正上传的图片,只能让选中上传的图片不显示出来
      if(a.files.length<=4){
          //上传的时候就清楚之前所有预览的图片
          $('#preview').html('');
          for (var x=0;x<a.files.length;x++){
              // 判断文件类型
              var fileType = a.files[x].type.split('/')[1];
              console.log('fileType');
              console.log(fileType);
              if(fileType == "png" || fileType == "jpeg" || fileType == "jpg"){
                  var file = a.files[x];
                  console.log(window.FileReader);
                  if (window.FileReader) {
                      console.log('进入window.FileReader');
                      var reader = new FileReader();
                      reader.readAsDataURL(file);
                      //监听文件读取结束后事件
                      reader.onloadend = function (e) {
                          //e.target.result就是最后的路径地址
  
                          var photo = `<img src="`+e.target.result+`" style="width: 50px;height: 50px" />`;
                          console.log('预览图片');
                          console.log(photo);
                          $('#preview').append(photo);
                      };
                  }
              }else{
                  warn("文件格式不正确");
              }
  
          }
      }else{
          warn('只能上传四张以下的图片');
      }
  
  
  }
  ```

- 这样上传图片只能上传你最后一次选中的图片,无论几张,你如果做了多次选中,那么之前的选中图片是无法上传的,除非你每选中一次就异步直接上传图片.

- 上传完毕之后在后端就可以使用`$FIELS`拿到具体的上传文件信息了.如果你上传多张,那么你使用`$_FILES['标签的name']['具体的属性比如name/type']`拿到的属性数组,也就是``$_FILES['标签的name']`这个数组的结构,是一个大数组,名字就是标签的name属性,然后大数组下面有很多的键,分别是name,type之类的,每个键下面就由对应你上传图片数量的值,用0,1,2排列.

- 所以在后端拿数据,就得`$_FILES['标签的name']['具体的属性比如name/type'][索引]`这样去拿.

- 由于我是把四张图存在同一条数据的四个字段,所以我写的上传方法是这样的.

  ```php
  /**
       * @param $name
       */
  function PicUpload($index){
      $url = "file/".date("Ym");
      if(!file_exists(serverRoot.$url)){
          mkdir(serverRoot.$url);
      }
  
      $max_file_size=200000000;     //上传文件大小限制, 单位BYTE
  
      $file=$_FILES['uploads'];
      $filetype = $file["type"][$index];
      $filesize = $file["size"][$index];
  
      $base64 = new base64_file("img");
      $expandedName = $base64->mime($filetype);
      $typeJudge = $this->typeFile($filetype);  // 文件类型判断
  
      //$typeJudge['warn']为空意味着typeFile方法没有传递错误信息,说明文件格式没问题
      //格式没问题才考虑判断大小,文件是否存在
      if(empty($typeJudge['warn'])){
          if($filesize > $max_file_size){                // 文件大小判断
              $json['warn'] = "文件太大!";
              exit;
          }
  
  
          $src = $url."/".suiji().".".$expandedName;
  
          $filename = iconv("UTF-8","gb2312",serverRoot.$src);
          //当文件存在
          if (file_exists($filename)) {
              //echo $fileName." already exists.";
              $json['warn'] = $filename."文件存在";
  
              $dir = $src;
  
          }else{//当文件不存在
              $chenggong = move_uploaded_file($_FILES['uploads']["tmp_name"][$index],$filename);
              $dir = $src;
          }
  
  
          return $dir;
      }
  }
  ```

- 具体处理数据的时候就可以这样使用了

  ```php
  $dir = $this->PicUpload($x);
  $update = update(array("table" => "workHoliday",
                         "field" => ['evidenceOne'=>$dir,"updateTime" => date("Y-m-d H:i:s")],
                         "where" => "id = '{$this->post['id']}'"));
  if($update=='更新成功'){
      $picSuccess++;
  }
  ```



## 上传文件

- 上传首先需要一个上传封装方法

  ```php
  /**
       * @param $name
       */
  function ThemeUpload($name){
      $url = "file/".date("Ym");
      if(!file_exists(serverRoot.$url)){
          mkdir(serverRoot.$url);
      }
  
      $max_file_size=200000000;     //上传文件大小限制, 单位BYTE
  
      $file=$_FILES[$name];
      $filetype = $file["type"];
      $filesize = $file["size"];
  
      $base64 = new base64_file("office");
      $expandedName = $base64->mime($filetype);
      $typeJudge = $this->typeFile($filetype);  // 文件类型判断
  
      //$typeJudge['warn']为空意味着typeFile方法没有传递错误信息,说明文件格式没问题
      //格式没问题才考虑判断大小,文件是否存在
      if(empty($typeJudge['warn'])){
          if($filesize > $max_file_size){                // 文件大小判断
              $json['warn'] = "文件太大!";
              exit;
          }
  
  
          $src = $url."/".suiji().".".$expandedName;
  
          $filename = iconv("UTF-8","gb2312",serverRoot.$src);
          //当文件存在
          if (file_exists($filename)) {
              //echo $fileName." already exists.";
              $json['warn'] = $filename."文件存在";
  
              $dir = $src;
  
          }else{//当文件不存在
              $chenggong = move_uploaded_file($_FILES[$name]["tmp_name"],$filename);
              $dir = $src;
          }
  
  
          //            return ['dir'=>$dir,'name'=>$file['name']];
          return $dir;
      }
  }
  ```

- 其中需要base64类和一个类型验证拓展,这个base64记得要去extend文件require

  ```php
  <?php
      /**
   * Created by PhpStorm.
   * User: admin
   * Date: 2020/3/24
   * Time: 17:29
   */
  
      class base64_file
  {
      //声明系统配置上传目录
      private $path;
      /**
       * 初始化类
       */
      public function __construct($path) {
          $this->path = $path;
      }
      public function file($base64,$dir = 'default'){
          $path_dir = "/".$this->path."/".$dir;
          $path_file = suiji();
          $base64_arr = explode(",",$base64);
          $base64_head = $base64_arr[0];
          $str_arr = explode(":",$base64_head);
          $str_arr = explode(";",$str_arr[1]);
          $suffix = $this->mime($str_arr[0]);
          $new_path = $path_dir."/".$path_file.".".$suffix;
          if(!is_dir(serverRoot.$path_dir)){
              if(!mkdir(serverRoot.$path_dir,0777,true)){
                  return [1,"创建失败 目录：".$path_dir];
              }
          }
          $newbase64 = str_replace($base64_head, '', $base64);
          file_put_contents(serverRoot.$new_path,base64_decode($newbase64));
          return $new_path;
      }
      /**
       * 获取文件的后缀
       * @param $type 当前文件的mime类型
       * @return bool 返回结果
       */
      public function mime($type){
          $arr = [
              '*' => 'application/octet-stream',
              '323' => 'text/h323',
              'acx' => 'application/internet-property-stream',
              'ai' => 'application/postscript',
              'aif' => 'audio/x-aiff',
              'aifc' => 'audio/x-aiff',
              'aiff' => 'audio/x-aiff',
              'asf' => 'video/x-ms-asf',
              'asr' => 'video/x-ms-asf',
              'asx' => 'video/x-ms-asf',
              'au' => 'audio/basic',
              'avi' => 'video/x-msvideo',
              'axs' => 'application/olescript',
              'bas' => 'text/plain',
              'bcpio' => 'application/x-bcpio',
              'bin' => 'application/octet-stream',
              'bmp' => 'image/bmp',
              'c' => 'text/plain',
              'cat' => 'application/vnd.ms-pkiseccat',
              'cdf' => 'application/x-cdf',
              'cer' => 'application/x-x509-ca-cert',
              'class' => 'application/octet-stream',
              'clp' => 'application/x-msclip',
              'cmx' => 'image/x-cmx',
              'cod' => 'image/cis-cod',
              'cpio' => 'application/x-cpio',
              'crd' => 'application/x-mscardfile',
              'crl' => 'application/pkix-crl',
              'crt' => 'application/x-x509-ca-cert',
              'csh' => 'application/x-csh',
              'css' => 'text/css',
              'dcr' => 'application/x-director',
              'der' => 'application/x-x509-ca-cert',
              'dir' => 'application/x-director',
              'dll' => 'application/x-msdownload',
              'dms' => 'application/octet-stream',
              'doc' => 'application/msword',
              'docx' => 'application/vnd.openxmlformats-officedocument.wordprocessingml.document',
              'dot' => 'application/msword',
              'dvi' => 'application/x-dvi',
              'dxr' => 'application/x-director',
              'eps' => 'application/postscript',
              'etx' => 'text/x-setext',
              'evy' => 'application/envoy',
              'exe' => 'application/octet-stream',
              'fif' => 'application/fractals',
              'flr' => 'x-world/x-vrml',
              'gif' => 'image/gif',
              'gtar' => 'application/x-gtar',
              'gz' => 'application/x-gzip',
              'h' => 'text/plain',
              'hdf' => 'application/x-hdf',
              'hlp' => 'application/winhlp',
              'hqx' => 'application/mac-binhex40',
              'hta' => 'application/hta',
              'htc' => 'text/x-component',
              'htm' => 'text/html',
              'html' => 'text/html',
              'htt' => 'text/webviewhtml',
              'ico' => 'image/x-icon',
              'ief' => 'image/ief',
              'iii' => 'application/x-iphone',
              'ins' => 'application/x-internet-signup',
              'isp' => 'application/x-internet-signup',
              'jfif' => 'image/pipeg',
              'jpe' => 'image/jpeg',
              'jpeg' => 'image/jpeg',
              'jpg' => 'image/jpeg',
              'js' => 'application/x-javascript',
              'latex' => 'application/x-latex',
              'lha' => 'application/octet-stream',
              'lsf' => 'video/x-la-asf',
              'lsx' => 'video/x-la-asf',
              'lzh' => 'application/octet-stream',
              'm13' => 'application/x-msmediaview',
              'm14' => 'application/x-msmediaview',
              'm3u' => 'audio/x-mpegurl',
              'man' => 'application/x-troff-man',
              'mdb' => 'application/x-msaccess',
              'me' => 'application/x-troff-me',
              'mht' => 'message/rfc822',
              'mhtml' => 'message/rfc822',
              'mid' => 'audio/mid',
              'mny' => 'application/x-msmoney',
              'mov' => 'video/quicktime',
              'movie' => 'video/x-sgi-movie',
              'mp2' => 'video/mpeg',
              'mp3' => 'audio/mpeg',
              'mpa' => 'video/mpeg',
              'mpe' => 'video/mpeg',
              'mpeg' => 'video/mpeg',
              'mpg' => 'video/mpeg',
              'mpp' => 'application/vnd.ms-project',
              'mpv2' => 'video/mpeg',
              'ms' => 'application/x-troff-ms',
              'mvb' => 'application/x-msmediaview',
              'nws' => 'message/rfc822',
              'oda' => 'application/oda',
              'p10' => 'application/pkcs10',
              'p12' => 'application/x-pkcs12',
              'p7b' => 'application/x-pkcs7-certificates',
              'p7c' => 'application/x-pkcs7-mime',
              'p7m' => 'application/x-pkcs7-mime',
              'p7r' => 'application/x-pkcs7-certreqresp',
              'p7s' => 'application/x-pkcs7-signature',
              'pbm' => 'image/x-portable-bitmap',
              'pdf' => 'application/pdf',
              'pfx' => 'application/x-pkcs12',
              'pgm' => 'image/x-portable-graymap',
              'pko' => 'application/ynd.ms-pkipko',
              'pma' => 'application/x-perfmon',
              'pmc' => 'application/x-perfmon',
              'pml' => 'application/x-perfmon',
              'pmr' => 'application/x-perfmon',
              'pmw' => 'application/x-perfmon',
              'pnm' => 'image/x-portable-anymap',
              'png' => 'image/png',
              'pot' => 'application/vnd.ms-powerpoint',
              'ppm' => 'image/x-portable-pixmap',
              'pps' => 'application/vnd.ms-powerpoint',
              'ppt' => 'application/vnd.ms-powerpoint',
              'prf' => 'application/pics-rules',
              'ps' => 'application/postscript',
              'pub' => 'application/x-mspublisher',
              'qt' => 'video/quicktime',
              'ra' => 'audio/x-pn-realaudio',
              'ram' => 'audio/x-pn-realaudio',
              'ras' => 'image/x-cmu-raster',
              'rgb' => 'image/x-rgb',
              'rmi' => 'audio/mid',
              'roff' => 'application/x-troff',
              'rtf' => 'application/rtf',
              'rtx' => 'text/richtext',
              'scd' => 'application/x-msschedule',
              'sct' => 'text/scriptlet',
              'setpay' => 'application/set-payment-initiation',
              'setreg' => 'application/set-registration-initiation',
              'sh' => 'application/x-sh',
              'shar' => 'application/x-shar',
              'sit' => 'application/x-stuffit',
              'snd' => 'audio/basic',
              'spc' => 'application/x-pkcs7-certificates',
              'spl' => 'application/futuresplash',
              'src' => 'application/x-wais-source',
              'sst' => 'application/vnd.ms-pkicertstore',
              'stl' => 'application/vnd.ms-pkistl',
              'stm' => 'text/html',
              'svg' => 'image/svg+xml',
              'sv4cpio' => 'application/x-sv4cpio',
              'sv4crc' => 'application/x-sv4crc',
              'swf' => 'application/x-shockwave-flash',
              't' => 'application/x-troff',
              'tar' => 'application/x-tar',
              'tcl' => 'application/x-tcl',
              'tex' => 'application/x-tex',
              'texi' => 'application/x-texinfo',
              'texinfo' => 'application/x-texinfo',
              'tgz' => 'application/x-compressed',
              'tif' => 'image/tiff',
              'tiff' => 'image/tiff',
              'tr' => 'application/x-troff',
              'trm' => 'application/x-msterminal',
              'tsv' => 'text/tab-separated-values',
              'txt' => 'text/plain',
              'uls' => 'text/iuls',
              'ustar' => 'application/x-ustar',
              'vcf' => 'text/x-vcard',
              'vrml' => 'x-world/x-vrml',
              'wav' => 'audio/x-wav',
              'wcm' => 'application/vnd.ms-works',
              'wdb' => 'application/vnd.ms-works',
              'wks' => 'application/vnd.ms-works',
              'wmf' => 'application/x-msmetafile',
              'wps' => 'application/vnd.ms-works',
              'wri' => 'application/x-mswrite',
              'wrl' => 'x-world/x-vrml',
              'wrz' => 'x-world/x-vrml',
              'xaf' =>'x-world/x-vrml',
              'xbm' => 'image/x-xbitmap',
              'xla' => 'application/vnd.ms-excel',
              'xlc' => 'application/vnd.ms-excel',
              'xlm' => 'application/vnd.ms-excel',
              'xls' => 'application/vnd.ms-excel',
              'xlt' => 'application/vnd.ms-excel',
              'xlw' => 'application/vnd.ms-excel',
              'xof' => 'x-world/x-vrml',
              'xpm' => 'image/x-xpixmap',
              'xwd' => 'image/x-xwindowdump',
              'z' => 'application/x-compress',
              'zip' => 'application/zip'
          ];
          $str = "";
          foreach($arr as $k => $v){
              if($type == $v){
                  $str = $k;
                  break;
              }
          }
          if($str == "jpe"){
              $str = "jpg";
          }
          return $str;
      }
  }
  ```

  ```php
  /**********文件类型识别********************************************************/
  //$type为当前文件类型，即HTTP content-type
  //注fileType为php自带函数
  function typeFile($type){
      $data = array(
          "img" => array(
              "image/jpeg",
              "image/png",
              "image/gif",
          ),
          "word" => array(
              "application/vnd.openxmlformats-officedocument.wordprocessingml.document",
              "application/msword",
          ),
          "excel" => array(
              "application/vnd.openxmlformats-officedocument.spreadsheetml.sheet",
              "application/vnd.ms-excel",
          ),
          "ppt" => array(
              "application/vnd.ms-powerpoint",
              "application/vnd.openxmlformats-officedocument.presentationml.presentation",
          ),
          "pdf" => array(
              "application/pdf",
          ),
          "zip" => array(
              "application/x-zip-compressed",
          ),
      );
      foreach($data as $key => $value){
          if(in_array($type,$value)){
              $result['type'] = $key;
          }
      }
      if($type == "application/octet-stream"){
          $result['warn'] = "未知文件类型，可能对系统造成风险！";
      }elseif(empty($result['type'])){
          $result['warn'] = "目前仅支持【".implode("，",array_keys($data))."】类型的文件上传，您当前的文件类型为【".$type."】";
      }
      return $result;
  }
  ```

- 同时,提交表单的方法也要换成可以上传文件的方法

  ```js
  /********异步提交函数**************************/
  //图片上传版本js
  function upForm(form,url){
      // alert(form);
      //防止高频点击
      var date = new Date();
      var time = date.getTime();//毫秒时间戳
      if(typeof minTime == "undefined"){
          var finger = 2;
          minTime = time+2000;//下次点击的最小时间
          console.log("定义minTime");
      }else{
          if(minTime && time < minTime){
              var finger = 1;
              warn("操作过于频繁");
              console.log("time:"+time+"，mintime:"+minTime+"，差额："+(time-minTime));
          }else{
              var finger = 2;
              console.log("time:"+time+"，mintime:"+minTime+"，多出："+(time-minTime));
              minTime = time+2000;//下次点击的最小时间
          }
      }
      if(finger == 2){
          $(function(){
              var formData = new FormData($("[name='"+form+"']")[0]);
              console.log(formData.get('file'));
              $.ajax({
                  url: url,
                  type: 'POST',
                  cache: false,
                  data: formData,
                  // 告诉jQuery不要去处理发送的数据
                  processData: false,
                  // 告诉jQuery不要去设置Content-Type请求头
                  contentType: false,
                  beforeSend: function () {
                      console.log("正在进行，请稍候");
                  },
                  success: function (res) {
                      var data = JSON.parse(res);
                      if (data.warn == 2) {
                          if (data.href) {//如果异步返回的json参数中定义了重定向url，则跳转到本url
                              window.location.href = data.href;
                          } else {
                              window.location.reload();
                          }
                      } else {
                          warn(data.warn);
                      }
                  },
                  error: function (responseStr) {
                      console.log("error");
                  }
              });
  
          })
      }
  }
  ```

  

## 导出

- 最新的导出

- ```php
  /***导出****/
  public function export(){
      /************************员工管理-导出excel*****************************/
      //查询你要导出的数据库表的所有备注和字段名
      $productArr = $this->sqlQueryAll("SELECT  
                          COLUMN_NAME as `字段名`,  
                          COLUMN_COMMENT  AS  `备注`  
                          FROM information_schema.COLUMNS WHERE TABLE_NAME='product'");
  
      foreach ($productArr as $thing){
          //如果表中有用不到的字段就用判断排除
          if($thing['字段名']!="id"&&$thing['字段名']!="time"&&$thing['字段名']!="updateTime"
             &&$thing['字段名']!="isUse"
            ){
              $wordArr[$thing['字段名']] = $thing['备注'];
          }
      }
      //取出session中存储的模糊查询sql语句
      $product = $this->sqlQueryAll($this->get['sql']);  //查你要导出的数据的那张表
      $config = [
          'path' => $this->getTmpDir() . '/',
      ];
      $name = "产品信息".date("YmdHis").".xlsx";
      $fileName   = $name ;
      $xlsxObject = new \Vtiful\Kernel\Excel($config);
  
      // Init File
      //    $fileObject = $excel->fileName($fileName);
      $fileObject = $xlsxObject->fileName($fileName);
      $head = array();
      $word = array();
      $sqlWord = array();
  
  
      foreach ($wordArr as $k=>$v){
          $sqlWord[] = $k;   //一维数组,字段名,英文
          $head[] = $wordArr[$k];  //一维数组,表头,中文
      }
      $head[] = "状态";
      foreach ($product as $c){
          $box = array();  //一维数组,放每个数据,直到塞满一条就清空
          foreach ($sqlWord as $english) {
              $box[] = $c[$english];
          }
          $box[] = $c['isUse']==0?'停用':'启用';
          $word[] = $box; //二维数组,[0] => 第一条数据,[1] => 第二条数据
      }
  
      // Writing data to a file ......
      $fileObject->header($head)->
          data($word);
      // Outptu
      $filePath = $fileObject->output();
  
      // Set Header
      header("Content-Type: application/vnd.openxmlformats-officedocument.spreadsheetml.sheet");
      header('Content-Disposition: attachment;filename="' . $fileName . '"');
      header('Cache-Control: max-age=0');
  
      if (copy($filePath, 'php://output') === false) {
          // Throw exception
      }
  
      // Delete temporary file
      @unlink($filePath);
  
  }
  ```

## Word

- html生成word文档

- 首先有两个方法,一个是生成文档,一个是生成并且下载文档

  ```php
  /***生成文档***/
  function createWord($content='',$fileName='new_file.doc'){
      if(empty($content)){
          return;
      }
      $content='<html 
              xmlns:o="urn:schemas-microsoft-com:office:office" 
              xmlns:w="urn:schemas-microsoft-com:office:word" 
              xmlns="http://www.w3.org/TR/REC-html40">
              <meta charset="UTF-8" />'.$content.'</html>';
      if(empty($fileName)){
          $fileName=date('YmdHis').'.doc';
      }
      $fp=fopen($fileName,'wb');
      fwrite($fp,$content);
      fclose($fp);
  }
  
  /**
       * @desc 方法二、生成word文档并下载
       * @param $content
       * @param string $fileName
       */
  function downloadWord($content, $fileName='new_file.doc'){
  
      if(empty($content)){
          return;
      }
  
      header("Cache-Control: no-cache, must-revalidate");
      header("Pragma: no-cache");
      header("Content-Type: application/octet-stream");
      header("Content-Disposition: attachment; filename=$fileName");
  
      $html = '<html xmlns:v="urn:schemas-microsoft-com:vml"
           xmlns:o="urn:schemas-microsoft-com:office:office"
           xmlns:w="urn:schemas-microsoft-com:office:word" 
           xmlns:m="http://schemas.microsoft.com/office/2004/12/omml" 
           xmlns="http://www.w3.org/TR/REC-html40">';
      $html .= '<head><meta charset="UTF-8" /></head>';
  
      echo $html . '<body>'.$content .'</body></html>';
  
  }
  ```

- 然后这次我使用的是先用layer选择一个参数,然后点击提交再进入一个新页面,就在这个新页面展示word文档以及导出按钮之类的东西

  ```php
  if(power("finalStatement","createFile")){
      $mx .= "<span class='spanButton' title='生成结算表' onclick=\"layer('finalStatement','createFinalStatement',{id:'" . $array['id'] . "'})\">生成结算表</span>&nbsp;";
  }
  
  //生成文档弹窗
  public function createFinalStatement(){
      $finalStatement = query("finalStatement"," id = '".$this->post['id']."' ");
      $hidden = hidden(['name'=>'id','value'=>$this->post['id']]);
      if(empty($finalStatement['id'])){
          $html = "传递过来的结算单ID查询不到具体数据"
              ;
      }else{
          if(empty($html)){
              $html = $this->layerEdit(array("table" => array(
                  must."选择模板：" => radio(array("name" => "template","value" => array("带签字栏","带备注栏"))),
              ),
                                             "hidden" => $hidden
  
                                            ));
  
          }
  
      }
  
      return $this->layer(array("title" => "选择模板","height" => 120,"width" => 800,"html" => $html));
  }
  public function createFinalStatementEdit(){
      //判断
      if(!power("finalStatement","createFile")){
          $json['warn'] = "权限不足";
      }elseif(empty($this->post['template'])){
          $json['warn'] = "请选择模板";
      }else{
          $json['warn'] = 2;
          $json['href'] = root."control/adIndex.php?cla=finalStatement&fun=reviewFinalStatement&id=".$this->post['id']."&template=".$this->post['template'];
          return json_encode($json,320);
      }
  }
  ```

- 之后跳转到具体的新函数中用html写好word样式,取出数据填充进去

  ```php
  public function reviewFinalStatement(){
  
      //判断
      if(!power("finalStatement","createFile")){
          $html = "权限不足";
      }elseif(empty($this->get['template'])){
          $html = "未接收到选择的模板";
      }elseif(empty($this->get['id'])){
          $html = "未接收到结算单的ID";
      }else{
          $finalStatement = query("finalStatement","id = '{$this->get['id']}'");
          $idStr = "'" . implode("','", json_decode($finalStatement['productListIdJson'],true)) . "'";
          $allProductList = $this->sqlQueryAll("select * from productList where id in ($idStr) order by time desc");
          $num = 1;
  
          $total = '';
          foreach($allProductList as $pl){
              $orderList = query("orderList","id = '{$pl['orderId']}'");
              $number = "<td width=\"20\" colspan=\"2\">$num</td>";
              $time = "<td width=\"100\" colspan=\"10\">".date("Y-m-d",strtotime($pl['time']))."</td>";
              $name = "<td width=\"120\" colspan=\"5\">".$pl['name']."</td>";
              $dataDetail = "<td width=\"600\" colspan=\"12\">
                  内容:".$pl['context']."\n规格:".$pl['specification']."\n工艺:".$pl['skill']."</td>";
              $count = "<td width=\"60\" colspan=\"4\">".$pl['count']."</td>";
              $price = "<td width=\"10\" colspan=\"3\">".$pl['price']."</td>";
              $money = "<td width=\"60\" colspan=\"4\">".$pl['price']*$pl['count']."</td>";
              $principal = "<td width=\"90\" colspan=\"3\">".$orderList['contacts']."</td>";
              $down = "<td width=\"150\" colspan=\"3\"></td>";
              $num++;
  
              $total .= "<tr>
                      $number$time$name$dataDetail$count$price$money$principal$down
                  </tr>";
          }
  
  
          $side = $this->get['template']=='带签字栏'?"签字":"备注";
  
          $print = "<div class='spanButton' style='float: left;float: top;margin-left: 20px'>打印</div>";
          $kehu = query("kehu","khid = '{$orderList['khid']}'");
  
          $html = "
  
                  <div style=\"font-family:微软雅黑;font-size:19px;font-weight: bold;text-align:center\">广告宣传服务费结算表</div>
                  <div id='unit' style='float: left;'>客户单位:".$kehu['unit']."</div>
                  <table border=\"1\" cellpadding=\"3\" cellspacing=\"0\">
                      <tr>
                          <th width=\"20\" colspan=\"2\">序：</th>
                          <th width=\"100\" colspan=\"10\">时间：</th>
                          <th width=\"120\" colspan=\"5\">产品名称：</th>
                          <th width=\"600\" colspan=\"12\">材料组成及制作工艺：</th>
                          <th width=\"60\" colspan=\"4\">数量：</th>
                          <th width=\"10\" colspan=\"3\">单价：</th>
                          <th width=\"60\" colspan=\"4\">小计：</th>
                          <th width=\"90\" colspan=\"3\">联系人：</th>
                          <th width=\"150\" colspan=\"3\">".$side."：</th>
                      </tr>
                      $total
                   </table>
  
              ";
          $postUrl = root."control/adIndex.php?cla=".$this->get['cla']."&fun=exportWord&id=".$this->get['id'];
          $export = "<a href='$postUrl' class='spanButton' style='float: left;float: top;margin-left: 50px'>导出</a>\n";
      }
      return head("ad").$export.$print.$html;
  }
  ```

- 然后在展示界面写好导出的按钮,跳转到本类的另一个函数,在那个函数中使用之前封装好的生成word文档并下载的函数,就可以下载这个文档了,使用即可,不需要return

  ```php
  public function exportWord(){
      if(empty($this->get['id'])){
          echo '没接收到ID';
      }else{
          $finalStatement = query("finalStatement","id = '{$this->get['id']}'");
          $idStr = "'" . implode("','", json_decode($finalStatement['productListIdJson'],true)) . "'";
          $allProductList = $this->sqlQueryAll("select * from productList where id in ($idStr) order by time desc");
          $num = 1;
  
          $total = '';
          foreach($allProductList as $pl){
              $orderList = query("orderList","id = '{$pl['orderId']}'");
              $number = "<td width=\"20\" colspan=\"2\">$num</td>";
              $time = "<td width=\"100\" colspan=\"10\">".date("Y-m-d",strtotime($pl['time']))."</td>";
              $name = "<td width=\"120\" colspan=\"5\">".$pl['name']."</td>";
              $dataDetail = "<td width=\"600\" colspan=\"12\">
                  内容:".$pl['context']."\n规格:".$pl['specification']."\n工艺:".$pl['skill']."</td>";
              $count = "<td width=\"60\" colspan=\"4\">".$pl['count']."</td>";
              $price = "<td width=\"10\" colspan=\"3\">".$pl['price']."</td>";
              $money = "<td width=\"60\" colspan=\"4\">".$pl['price']*$pl['count']."</td>";
              $principal = "<td width=\"90\" colspan=\"3\">".$orderList['contacts']."</td>";
              $down = "<td width=\"150\" colspan=\"3\"></td>";
              $num++;
  
              $total .= "<tr>
                      $number$time$name$dataDetail$count$price$money$principal$down
                  </tr>";
          }
  
  
          $side = $this->get['template']=='带签字栏'?"签字":"备注";
  
          $kehu = query("kehu","khid = '{$orderList['khid']}'");
          $html = "
  
                  <div style=\"font-family:微软雅黑;font-size:19px;font-weight: bold;text-align:center\">广告宣传服务费结算表</div>
                  <div id='unit' style='float: left;'>客户单位:".$kehu['unit']."</div>
                  <table border=\"1\" cellpadding=\"3\" cellspacing=\"0\">
                      <tr>
                          <th width=\"20\" colspan=\"2\">序：</th>
                          <th width=\"100\" colspan=\"10\">时间：</th>
                          <th width=\"120\" colspan=\"5\">产品名称：</th>
                          <th width=\"600\" colspan=\"12\">材料组成及制作工艺：</th>
                          <th width=\"60\" colspan=\"4\">数量：</th>
                          <th width=\"10\" colspan=\"3\">单价：</th>
                          <th width=\"60\" colspan=\"4\">小计：</th>
                          <th width=\"90\" colspan=\"3\">联系人：</th>
                          <th width=\"150\" colspan=\"3\">".$side."：</th>
                      </tr>
                      $total
                   </table>
  
              ";
          $this->downloadWord($html,suiji().".doc");
      }
      //        return $html;
  }
  
  ```
